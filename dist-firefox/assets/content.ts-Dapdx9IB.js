(function(){(function(){console.log("Web Walker: Content script injected.");const o=new Map;let u=0;function m(){o.clear(),u=0;function t(n){return!!(n.offsetWidth||n.offsetHeight||n.getClientRects().length)}function i(n){if(n.nodeType===Node.TEXT_NODE&&n.textContent?.trim())return n.textContent.trim().replace(/\s+/g," ");if(n.nodeType!==Node.ELEMENT_NODE)return"";const e=n;if(!t(e)||["SCRIPT","STYLE","NOSCRIPT","HEAD","META","LINK"].includes(e.tagName))return"";let l=Array.from(e.childNodes).map(i).join(" ");const a=window.getComputedStyle(e).cursor==="pointer",s=["INPUT","TEXTAREA","SELECT"].includes(e.tagName);if((a||s)&&(e.innerText.trim()||e.getAttribute("aria-label")||e.getAttribute("placeholder"))){const d=e.id||`ai-element-${u++}`;o.set(d,e);let c="element";s?c=e.tagName.toLowerCase():a&&(c="button");const T=e.innerText.trim()||e.getAttribute("aria-label")||e.getAttribute("placeholder");return`<interactive id="${d}" type="${c}">${T}</interactive>`}return l}const r=i(document.body);return console.log("Web Walker: Simplified DOM created, elements tracked:",o.size),r}chrome.runtime.onMessage.addListener((t,i,r)=>{switch(console.log("Web Walker: Message received in content script",t),t.type){case"GET_CONTEXT":const n=m();console.log("GET_CONTEXT666",n),r({dom:n});break;case"EXECUTE_CLICK":const e=o.get(t.elementId);e?(e.click(),console.log(`Web Walker: Clicked element ${t.elementId}`),r({status:"ok"})):(console.error(`Web Walker: Element with id ${t.elementId} not found for CLICK.`),r({status:"error",reason:"Element not found"}));break;case"EXECUTE_TYPE":const l=o.get(t.elementId);l?(l.value=t.text,console.log(`Web Walker: Typed into element ${t.elementId}`),r({status:"ok"})):(console.error(`Web Walker: Element with id ${t.elementId} not found for TYPE.`),r({status:"error",reason:"Element not found"}));break;default:console.warn("Web Walker: Unknown message type received",t.type);break}return!0});chrome.runtime.sendMessage({type:"CONTENT_SCRIPT_READY"}).catch(t=>console.error("Web Walker: Failed to send CONTENT_SCRIPT_READY message:",t));
})()
})()
